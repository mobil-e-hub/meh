<html lang="en">
    <head>
        <title>Socket GUI</title>
    </head>

    <body>
        <h1>Drone simulation</h1>

        <svg id="svg" style="width: 100%; height: 400px; border-style: solid">
            <circle id="c" cx="50" cy="50" r="40" stroke="green" stroke-width="4" fill="yellow" />
        </svg>

        <pre id="stateTxt" style="height: 100px; overflow: scroll"></pre>
        <button id="startBtn" style="width: 100%; height: 30px;">Start simulation</button>
    </body>

    <script>
        const startBtn = document.querySelector('#startBtn');
        const stateTxt = document.querySelector('#stateTxt');
        const svg = document.querySelector('#svg');

        let ws;

        function showState(state) {
            stateTxt.textContent = state;
        }

        function drawState(state) {
            console.log(state);
            let c = document.querySelector('#c');
            c.setAttribute('cx', state * 50);
        }

        function init() {
            if (ws) {
                ws.onerror = ws.onopen = ws.onclose = null;
                ws.close();
            }

            ws = new WebSocket('ws://localhost:6969');
            ws.onopen = () => {
                console.log('Connection opened!');
                ws.send('stop');
            };
            ws.onmessage = ({ data }) => drawState(data);
            ws.onclose = function() {
                ws = null;
            }
        }

        startBtn.onclick = function() {
            if (!ws) {
                showState("No WebSocket connection :(");
            }
            else {
                if (startBtn.textContent === 'Start simulation') {
                    ws.send('start');
                    startBtn.textContent = 'Stop simulation';
                }
                else {
                    ws.send('stop');
                    startBtn.textContent = 'Start simulation';
                }
            }
        };

        init();
    </script>
</html>
