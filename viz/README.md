# meh-sim: Visualization (Vue web app) for mobil-e-Hub
Authors: 
- Michael Pernpeintner (pernpeintner@es.uni-mannheim.de)
- Alexander Becker
- Tim Grams

## Installation and usage
```shell script
meh % cd viz/vue
vue % npm install
vue % npm run vue
```

## Communication with EventGrid
Since EventGrid can only publish messages to an HTTP endpoint, communication with EventGrid is asymmetric: Messages can be directly sent via axios, but incoming messages are received over a web socket. Both directions are provided to Vue through the eventgrid wrapper plugin.

### Publishing messages to EventGrid
From a Vue component, call 
```javascript
this.$eventgrid.publish(topic, message='', sender='visualization/<id>');
```

### Receiving messages from EventGrid
In the `created()` lifecycle function, subscribe to topics using 
```javascript
this.$eventgrid.subscribe(pattern, handler);
```

## Communication with MQTT -
Communication between entities exclusively uses the private mosquitto MQTT broker `wss://ines-gpu-01.informatik.uni-mannheim.de/meh/mqtt`.

All topics start with `mobil-e-hub/v1/[from|to]/[entity]/[id]/`, and all messages are string representations of JSON objects.
Each entity publishes `{ topic: mobil-e-hub/v1/from/[entity]/[id]/connected, message: ''}` upon connection.

The following table lists all currently used topics in this project with short explanations on their usage

Entities comprise: Hub, Drone, Car, Bus, Parcel, (Order) - messages send by the corresponding simulators


| Topic | Usage | Sender | Receiver |
|---	|---	|--- |--- |
|connected  	| upon connection  	|Entity | |
|state 	| on state change 	| Entity  | |
| | | | |
|start	|  	| viz | all |
|pause  	|  	| viz | all |
|resume  	|  	| viz | all |
|stop 	|  	| viz | all |
|test*	| used during DEV | viz | viz |
| | | | |
|place  	| parcel added -> triggers delivery	| viz | Entity, Opt|
|placed  	|  	| Parcel| Entity, Opt |
|transfer  	|  	| Entity | Parcel |
|delivered  |	| Parcel | Entity, Opt | 
| | | | |
|transaction/./ready 	| Receiving instance ready for transaction	| Entity | Entity|
|"/./unready  	|  	Receiving instance no longer ready for transaction | Entity | Entity, (Opt) |
|"/./execute  |	| Entity | Entity | 
|"/./complete  |	| Entity | Entity |
| | | | |
|mission	| | opt_engine | Entity	|
|"/./complete	| | Entity | 	|
|("/./failed)	| not implemented yet | Entity | 	|
---
## Project Structure

### Visualization
Vue.js client for the visualization of a running DLN.

### Functionality
##### Display of system state from MQTT messages
The Visualization client shows on a map all entities from which it receives state updates via MQTT, as well as important events such as _Parcel delivered_ or _Order placed_.

##### Control of simulators
The simulators can be started, paused, resumed and stopped from the Visualization client. This is not part of the core functionality, but it is necessary for the project phase where all data is generated by a simulator rather than by real vehicles and customers.

